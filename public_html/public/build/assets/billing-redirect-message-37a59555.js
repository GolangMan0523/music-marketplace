import{cl as z,dT as F,r as o,bz as W,u as B,a2 as R,j as a,c as V,H as T,U as c,A as q,m as k,W as A,dO as G,T as N,ac as U}from"./main-0876e57f.js";import{T as O}from"./TaskAlt-bcfe15fb.js";var _="https://js.stripe.com/v3",X=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,P="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",H=function(){for(var e=document.querySelectorAll('script[src^="'.concat(_,'"]')),t=0;t<e.length;t++){var r=e[t];if(X.test(r.src))return r}return null},I=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(_).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(r),r},J=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})},S=null,w=null,E=null,K=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Q=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Y=function(e){return S!==null?S:(S=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(P),window.Stripe){t(window.Stripe);return}try{var s=H();if(s&&e)console.warn(P);else if(!s)s=I(e);else if(s&&E!==null&&w!==null){var i;s.removeEventListener("load",E),s.removeEventListener("error",w),(i=s.parentNode)===null||i===void 0||i.removeChild(s),s=I(e)}E=Q(t,r),w=K(r),s.addEventListener("load",E),s.addEventListener("error",w)}catch(l){r(l);return}}),S.catch(function(t){return S=null,Promise.reject(t)}))},Z=function(e,t,r){if(e===null)return null;var s=e.apply(void 0,t);return J(s,r),s},x,C=!1,D=function(){return x||(x=Y(null).catch(function(e){return x=null,Promise.reject(e)}),x)};Promise.resolve().then(function(){return D()}).catch(function(n){C||console.warn(n)});var $=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];C=!0;var s=Date.now();return D().then(function(i){return Z(i,t,s)})};function ee({type:n,productId:e,priceId:t}){const{user:r}=z(),s=F(),i=o.useRef(!1),l=o.useRef(null),{localeCode:h}=W(),[d,j]=o.useState(null),[y,b]=o.useState(null),{branding:{site_name:m},billing:{stripe_public_key:u,stripe:{enable:p}}}=B();return o.useEffect(()=>{!p||!u||i.current||(Promise.all([$(u,{apiVersion:"2022-08-01",locale:h}),n==="setupIntent"?te():re(e,t)]).then(([f,{clientSecret:g}])=>{if(f&&l.current){const v=f.elements({clientSecret:g,appearance:{theme:s?"night":"stripe"}});v.create("payment",{business:{name:m},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:r==null?void 0:r.email}}}).mount(l.current),j(f),b(v)}}),i.current=!0)},[e,u,p,s,h,m,n,r==null?void 0:r.email]),{stripe:d,elements:y,paymentElementRef:l,stripeIsEnabled:u!=null&&p}}function te(){return R.post("billing/stripe/create-setup-intent").then(n=>n.data)}function re(n,e){return R.post("billing/stripe/create-partial-subscription",{product_id:n,price_id:e}).then(t=>t.data)}function le({productId:n,priceId:e,type:t="subscription",submitLabel:r,returnUrl:s}){const{stripe:i,elements:l,paymentElementRef:h,stripeIsEnabled:d}=ee({type:t,productId:n,priceId:e}),[j,y]=o.useState(null),[b,m]=o.useState(!1),u=!d||l!=null&&i!=null,p=async f=>{var g,v;if(f.preventDefault(),!(!i||!l)){m(!0);try{const L=await i[t==="subscription"?"confirmPayment":"confirmSetup"]({elements:l,confirmParams:{return_url:s}});((g=L.error)==null?void 0:g.type)!=="validation_error"&&((v=L.error)!=null&&v.message)&&y(L.error.message)}catch{}m(!1)}};return a.jsxs("form",{onSubmit:p,children:[a.jsx("div",{ref:h,className:V("min-h-[303px]",!d&&"hidden"),children:d&&a.jsx(ne,{})}),j&&!b&&a.jsx("div",{className:"mt-20 text-danger",children:j}),a.jsx(T,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:b||!u,children:r})]})}function ne(){return a.jsxs(o.Fragment,{children:[a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"mb-20 h-30"}),a.jsx(c,{className:"h-30"})]})}function oe({config:n}){return a.jsx(q,{initial:!1,mode:"wait",children:a.jsx("div",{className:"mt-80",children:n?a.jsxs(k.div,{className:"text-center",...A,children:[n.status==="success"?a.jsx(O,{className:"text-positive text-6xl"}):a.jsx(G,{className:"text-danger text-6xl"}),a.jsx("div",{className:"text-2xl font-semibold mt-30",children:a.jsx(N,{...n.message})}),a.jsx(T,{variant:"flat",color:"primary",className:"w-full mt-30",size:"md",elementType:U,to:n.link,children:a.jsx(N,{...n.buttonLabel})})]},"payment-status"):a.jsx(se,{},"loading-skeleton")})})}function se(){return a.jsxs(k.div,{className:"text-center max-w-280",...A,children:[a.jsx(c,{size:"w-50 h-50",variant:"rect"}),a.jsx(c,{className:"text-2xl mt-30"}),a.jsx(c,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{oe as B,le as S,$ as l};
//# sourceMappingURL=billing-redirect-message-37a59555.js.map
