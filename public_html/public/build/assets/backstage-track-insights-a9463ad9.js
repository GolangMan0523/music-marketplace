import{aR as je,dh as aa,di as Xs,h as I,dj as Ue,dk as na,dl as be,dm as ve,dn as Rs,dp as zs,l as Q,j as s,R as Ke,c as S,o as ra,au as us,b4 as et,b5 as st,b6 as tt,$ as Ie,dq as ia,dr as la,ds as ms,r as u,dt as X,n as We,du as as,dv as ns,dw as he,dx as ye,dy as at,d as W,bz as ne,p as Ge,dz as ee,dA as oa,dB as ca,dC as da,dD as ua,dE as ma,dF as xa,dG as fa,m as se,I as q,K as ha,u as Z,b0 as nt,dH as rt,dI as pa,ak as it,al as lt,T as d,w as xs,Q as Qe,H as V,x as Ce,z as De,am as ot,A as Ze,az as re,bA as Ye,a2 as L,ap as Pe,f as fs,t as _,S as ga,k as hs,W as ps,ae as ke,U as pe,ab as ct,dJ as ja,d4 as ba,dK as va,dL as ya,aF as gs,P as ka,dM as wa,dg as Na,g as _e,e as te,E as Se,b2 as Ms,X as Ia,dN as R,aB as Ca,dO as Da,bE as Pa,dP as Sa,V as js,Z as ce,a1 as Aa,bG as Ls,bH as Fa,a0 as ae,dQ as Ta,dR as Va,ah as Je,v as M,_ as de,a8 as Ae,B as ie,aJ as Fe,aA as ue,aE as me,c6 as Oe,bq as bs,cA as $a,aD as vs,c4 as He,y as ys,ag as dt,a6 as ks,a4 as ut,a5 as mt,a3 as xt,cX as Ra,cI as ft,bp as za,bn as Xe,bh as ws,c3 as es,ac as J,aP as ht,dS as Ma,J as La,cl as Ea,dT as Ua,a as pt,cQ as gt,cR as jt,cS as bt,b as vt,cY as _a,aI as ss,bo as Ns,ad as Oa,dU as Ha,a9 as qa,aV as Ba,aW as Ka,aX as Re,aY as Wa,aZ as ze,c1 as Ga,dV as Qa,ao as Za,b1 as Ya,dW as Ja,cu as Xa,cD as Es,cj as en,bj as yt,bw as sn,bi as kt,bk as wt,Y as tn}from"./main-0876e57f.js";import{K as an,l as nn,A as Is,C as Nt,o as rn,G as Cs,a as ln,k as It,D as on,u as cn,j as Ct,p as dn,g as un,T as mn,F as qe,P as xn,i as Dt,t as Us,U as fn}from"./theme-value-to-hex-bf3f886b.js";import{E as Ds}from"./Edit-f6be60d1.js";function Pt(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}function H(e){return e.set({hour:24-1,minute:60-1,second:60-1,millisecond:1e3-1})}function hn(){var a,n,r;const e=(a=je())==null?void 0:a.settings.dates.default_timezone,t=((r=(n=je())==null?void 0:n.user)==null?void 0:r.timezone)||e||"auto";return!t||t==="auto"?aa():t}const T=Pt(Xs(hn()));var Ys,Js;const rs=((Js=(Ys=je())==null?void 0:Ys.i18n)==null?void 0:Js.language)||"en",St=[{key:0,label:I("Today"),getRangeValue:()=>({preset:0,start:T,end:H(T)})},{key:1,label:I("Yesterday"),getRangeValue:()=>({preset:1,start:T.subtract({days:1}),end:H(T).subtract({days:1})})},{key:2,label:I("This week"),getRangeValue:()=>({preset:2,start:Ue(T,rs),end:na(H(T),rs)})},{key:3,label:I("Last week"),getRangeValue:()=>{const e=Ue(T,rs).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:I("Last 7 days"),getRangeValue:()=>({preset:4,start:T.subtract({days:7}),end:H(T)})},{key:6,label:I("Last 30 days"),getRangeValue:()=>({preset:6,start:T.subtract({days:30}),end:H(T)})},{key:7,label:I("Last 3 months"),getRangeValue:()=>({preset:7,start:T.subtract({months:3}),end:H(T)})},{key:8,label:I("Last 12 months"),getRangeValue:()=>({preset:8,start:T.subtract({months:12}),end:H(T)})},{key:9,label:I("This month"),getRangeValue:()=>({preset:9,start:be(T),end:ve(H(T))})},{key:10,label:I("This year"),getRangeValue:()=>({preset:10,start:Rs(T),end:zs(H(T))})},{key:11,label:I("Last year"),getRangeValue:()=>({preset:11,start:Rs(T).subtract({years:1}),end:zs(H(T)).subtract({years:1})})}],At=Q(s.jsx("path",{d:"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z"}),"DateRangeOutlined"),Ft=Ke.forwardRef((e,t)=>{const{children:a,inputProps:n,wrapperProps:r,className:i,autoFocus:o,style:l,onClick:c}=e;return s.jsx("div",{...r,onClick:c,children:s.jsx("div",{...n,role:"group",className:S(i,"flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60"),ref:t,style:l,children:s.jsx(ra,{autoFocus:o,children:a})})})}),Tt=Ke.forwardRef(({inputRef:e,wrapperProps:t,children:a,onBlur:n,...r},i)=>{const o=us(r),l=et(i),{fieldProps:c,inputProps:f}=st({...r,focusRef:l,labelElementType:"span"});return o.wrapper=S(o.wrapper,r.disabled&&"pointer-events-none"),s.jsx(tt,{wrapperProps:Ie(t,{onBlur:m=>{l.current&&!l.current.contains(m.relatedTarget)&&(n==null||n(m))},onClick:()=>{const m=ia(l);m==null||m.focusFirst()}}),fieldClassNames:o,ref:l,...c,children:s.jsx(Ft,{inputProps:f,className:S(o.input,"gap-10"),ref:e,children:a})})});function pn(e){return e instanceof la?"day":"minute"}function os(e,t,a){return t!=null&&e.compare(t)<0||a!=null&&e.compare(a)>0}function Vt(e,t){const a=ms(),[n,r]=u.useState(!1),i=t.closeDialogOnSelection??!0,o=t.granularity||pn(e),l=t.min?X(t.min,a):void 0,c=t.max?X(t.max,a):void 0;return{timezone:a,granularity:o,min:l,max:c,calendarIsOpen:n,setCalendarIsOpen:r,closeDialogOnSelection:i}}function Te(){const e=ms();return u.useMemo(()=>Xs(e),[e])}function _s(e){var oe,Y;const t=Te(),[a,n]=u.useState({start:(!e.value||!e.value.start)&&!((oe=e.defaultValue)!=null&&oe.start),end:(!e.value||!e.value.end)&&!((Y=e.defaultValue)!=null&&Y.end)}),r=e.onChange,[i,o]=We(e.value?ls(e.value,t):void 0,e.value?void 0:ls(e.defaultValue,t),v=>{n({start:!1,end:!1}),r==null||r(v)}),{min:l,max:c,granularity:f,timezone:m,calendarIsOpen:x,setCalendarIsOpen:p,closeDialogOnSelection:h}=Vt(i.start,e),g=u.useCallback(()=>{n({start:!0,end:!0}),o(ls(null,t)),r==null||r(null),p(!1)},[t,o,r,p]),[j,y]=u.useState(null),[k,w]=u.useState(!1),[A,D]=u.useState(i),[z,O]=u.useState(()=>Os(i,c)),b=u.useCallback(v=>{let N=v.start,F=v.end;l&&(N=as(N,l));const E=c?ns(c,F):F;N=ns(N,E);const fe=l?as(l,N):N;return F=as(F,fe),c&&(F=ns(F,c)),{start:X(N,m),end:X(F,m)}},[l,c,m]),C=u.useCallback(v=>{const N={...b(v),preset:v.preset};o(N),D(N),O(Os(N,c)),n({start:!1,end:!1})},[o,b,c]),P=u.useCallback(v=>!a.start&&he(v,A.start)||!a.end&&he(v,A.end),[A,a]),$=u.useCallback(v=>(k||!a.start&&!a.end)&&v.compare(A.start)>=0&&v.compare(A.end)<=0,[A,a,k]),K=u.useCallback(v=>he(v,A.start),[A]),B=u.useCallback(v=>he(v,A.end),[A]),le=u.useCallback((v,N)=>({onPointerEnter:()=>{k&&N&&D(is({start:j,end:v,timezone:m}))},onClick:()=>{if(!k)w(!0),y(v),D(is({start:v,end:v,timezone:m}));else{const F=is({start:j,end:v,timezone:m});F.start=Pt(F.start),F.end=H(F.end),w(!1),y(null),C==null||C(F),h&&(p==null||p(!1))}}}),[j,k,C,p,h,m]);return{selectedValue:i,setSelectedValue:C,calendarIsOpen:x,setCalendarIsOpen:p,dayIsActive:P,dayIsHighlighted:$,dayIsRangeStart:K,dayIsRangeEnd:B,getCellProps:le,calendarDates:z,setIsPlaceholder:n,isPlaceholder:a,clear:g,setCalendarDates:O,min:l,max:c,granularity:f,timezone:m,closeDialogOnSelection:h}}function Os(e,t){let a=ye(be(e.start)),n=ye(ve(e.end));return at(a,n)&&(n=ve(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=be(a.subtract({months:1}))),[a,n]}function is(e){const t=X(e.start,e.timezone),a=X(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function ls(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}const gn=Q(s.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z"}),"ArrowRightAltOutlined");function jn(e,t,a,n){switch(t){case"era":case"year":case"month":case"day":return e.cycle(t,a,{round:t==="year"})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return e.set({hour:i?r-12:r+12})}case"hour":case"minute":case"second":return e.cycle(t,a,{round:t!=="hour",hourCycle:n.hour12?12:24})}return e}function bn(e,t,a,n){switch(t){case"day":case"month":case"year":return e.set({[t]:a})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return a>=12===i?e:e.set({hour:i?r-12:r+12})}case"hour":if(n.hour12){const i=e.hour>=12;!i&&a===12&&(a=0),i&&a<12&&(a+=12)}case"minute":case"second":return e.set({[t]:a})}return e}const Hs={year:5,month:2,day:7,hour:2,minute:15,second:15,dayPeriod:1};function vn({segment:e,domProps:t,value:a,onChange:n,isPlaceholder:r,state:{timezone:i,calendarIsOpen:o,setCalendarIsOpen:l}}){const c=W(),f=u.useRef(""),{localeCode:m}=ne(),x=Ge(),p=ee({timeZone:i}),h=u.useMemo(()=>new oa(m,{maximumFractionDigits:0}),[m]),g=b=>{n(bn(a,e.type,b,p.resolvedOptions()))},j=b=>{n(jn(a,e.type,b,p.resolvedOptions()))},y=()=>{if(h.isValidPartialNumber(e.text)){const b=e.text.slice(0,-1),C=h.parse(b);if(b.length===0||C===0){const P=ca(i);e.type in P&&g(P[e.type])}else g(C);f.current=b}else e.type==="dayPeriod"&&j(-1)},k=b=>{var C;if(!(b.ctrlKey||b.metaKey||b.shiftKey||b.altKey)){switch(b.key){case"ArrowLeft":b.preventDefault(),b.stopPropagation(),x==null||x.focusPrevious();break;case"ArrowRight":b.preventDefault(),b.stopPropagation(),x==null||x.focusNext();break;case"Enter":(C=b.target.closest("form"))==null||C.requestSubmit(),l(!o);break;case"Tab":break;case"Backspace":case"Delete":{b.preventDefault(),b.stopPropagation(),y();break}case"ArrowUp":b.preventDefault(),f.current="",j(1);break;case"ArrowDown":b.preventDefault(),f.current="",j(-1);break;case"PageUp":b.preventDefault(),f.current="",j(Hs[e.type]||1);break;case"PageDown":b.preventDefault(),f.current="",j(-(Hs[e.type]||1));break;case"Home":b.preventDefault(),f.current="",g(e.maxValue);break;case"End":b.preventDefault(),f.current="",g(e.minValue);break}z(b.key)}},w=ee({hour:"numeric",hour12:!0}),A=u.useMemo(()=>{const b=new Date;return b.setHours(0),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),D=u.useMemo(()=>{const b=new Date;return b.setHours(12),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),z=b=>{const C=f.current+b;switch(e.type){case"dayPeriod":if(A.toLowerCase().startsWith(b))g(0);else if(D.toLowerCase().startsWith(b))g(12);else break;x==null||x.focusNext();break;case"day":case"hour":case"minute":case"second":case"month":case"year":{if(!h.isValidPartialNumber(C))return;let P=h.parse(C),$=P,K=e.minValue===0;if(e.type==="hour"&&p.resolvedOptions().hour12){switch(p.resolvedOptions().hourCycle){case"h11":P>11&&($=h.parse(b));break;case"h12":K=!1,P>12&&($=h.parse(b));break}e.value>=12&&P>1&&(P+=12)}else P>e.maxValue&&($=h.parse(b));if(Number.isNaN(P))return;const B=$!==0||K;B&&g($),+`${P}0`>e.maxValue||C.length>=String(e.maxValue).length?(f.current="",B&&(x==null||x.focusNext())):f.current=C;break}}},O=c?{}:{"aria-label":e.type,"aria-valuetext":r?void 0:`${e.value}`,"aria-valuemin":e.minValue,"aria-valuemax":e.maxValue,"aria-valuenow":r?void 0:e.value,tabIndex:0,onKeyDown:k};return s.jsx("div",{...Ie(t,{...O,onFocus:b=>{f.current="",b.target.scrollIntoView({block:"nearest"})},onClick:b=>{b.preventDefault(),b.stopPropagation()}}),className:"box-content cursor-default select-none whitespace-nowrap rounded p-2 text-center tabular-nums caret-transparent outline-none focus:bg-primary focus:text-on-primary",children:e.text.padStart(e.minLength,"0")})}function yn({segment:e,domProps:t}){const a=Ge();return s.jsx("div",{...t,onPointerDown:n=>{n.pointerType==="mouse"&&(n.preventDefault(),a!=null&&a.focusNext({from:n.target})||a==null||a.focusPrevious({from:n.target}))},"aria-hidden":!0,className:"min-w-4 cursor-default select-none",children:e.text})}function kn(e,t,a){switch(t){case"year":return{value:e.year,placeholder:"yyyy",minValue:1,maxValue:e.calendar.getYearsInEra(e)};case"month":return{value:e.month,placeholder:"mm",minValue:ua(e),maxValue:e.calendar.getMonthsInYear(e)};case"day":return{value:e.day,minValue:da(e),maxValue:e.calendar.getDaysInMonth(e),placeholder:"dd"}}if("hour"in e)switch(t){case"dayPeriod":return{value:e.hour>=12?12:0,minValue:0,maxValue:12,placeholder:"--"};case"hour":if(a.hour12){const n=e.hour>=12;return{value:e.hour,minValue:n?12:0,maxValue:n?23:11,placeholder:"--"}}return{value:e.hour,minValue:0,maxValue:23,placeholder:"--"};case"minute":return{value:e.minute,minValue:0,maxValue:59,placeholder:"--"}}return{}}function cs({segmentProps:e,state:t,value:a,onChange:n,isPlaceholder:r}){const{granularity:i}=t,o=u.useMemo(()=>{const m={year:"numeric",month:"numeric",day:"numeric"};return i==="minute"&&(m.hour="numeric",m.minute="numeric"),m},[i]),l=ee(o),c=u.useMemo(()=>a.toDate(),[a]),f=u.useMemo(()=>l.formatToParts(c).map(m=>{const x=kn(a,m.type,l.resolvedOptions()),p=r&&m.type!=="literal"?x.placeholder:m.value;return{type:m.type,text:m.value===", "?" ":p,...x,minLength:m.type!=="literal"?String(x.maxValue).length:1}}),[c,l,r,a]);return s.jsx("div",{className:"flex items-center",children:f.map((m,x)=>m.type==="literal"?s.jsx(yn,{domProps:e,segment:m},x):s.jsx(vn,{isPlaceholder:r,domProps:e,state:t,value:a,onChange:n,segment:m},x))})}function wn({date:e,currentMonth:t,state:{dayIsActive:a,dayIsHighlighted:n,dayIsRangeStart:r,dayIsRangeEnd:i,getCellProps:o,timezone:l,min:c,max:f}}){const{localeCode:m}=ne(),x=ma(e,m),p=a(e),h=n(e),g=r(e),j=i(e),y=xa(e,l),k=at(e,t),w=os(e,c,f);return s.jsxs("div",{role:"button","aria-disabled":w,className:S("w-40 h-40 text-sm relative isolate flex-shrink-0",w&&"text-disabled pointer-events-none",!k&&"invisible pointer-events-none"),...o(e,k),children:[s.jsx("span",{className:S("absolute inset-0 flex items-center justify-center rounded-full w-full h-full select-none z-10 cursor-pointer",!p&&!y&&"hover:bg-hover",p&&"bg-primary text-on-primary font-semibold",y&&!p&&"bg-chip"),children:e.day}),h&&k&&s.jsx("span",{className:S("absolute w-full h-full inset-0 bg-primary/focus",(g||x===0||e.day===1)&&"rounded-l-full",(j||x===6||e.day===t.calendar.getDaysInMonth(t))&&"rounded-r-full")})]})}function Nn({startDate:e,state:t,isFirst:a,isLast:n}){const{localeCode:r}=ne(),i=fa(e,r),o=Ue(e,r);return s.jsxs("div",{className:"w-280 flex-shrink-0",children:[s.jsx(In,{isFirst:a,isLast:n,state:t,currentMonth:e}),s.jsxs("div",{className:"block",role:"grid",children:[s.jsx(Cn,{state:t,startDate:e}),[...new Array(i).keys()].map(l=>s.jsx(se.div,{className:"flex mb-6",children:[...new Array(7).keys()].map(c=>s.jsx(wn,{date:o.add({weeks:l,days:c}),currentMonth:e,state:t},c))},l))]})]})}function In({currentMonth:e,isFirst:t,isLast:a,state:{calendarDates:n,setCalendarDates:r,timezone:i,min:o,max:l}}){const c=p=>{const h=n.length;let g;p==="forward"?g=n.map(j=>ve(j.add({months:h}))):g=n.map(j=>ve(j.subtract({months:h}))),r(g)},f=ee({month:"long",year:"numeric",era:e.calendar.identifier!=="gregory"?"long":void 0,calendar:e.calendar.identifier}),m=os(e.subtract({days:1}),o,l),x=os(be(e.add({months:1})),o,l);return s.jsxs("div",{className:"flex items-center justify-between gap-10",children:[s.jsx(q,{size:"md",className:S("text-muted",!t&&"invisible"),disabled:!t||m,"aria-hidden":!t,onClick:()=>{c("backward")},children:s.jsx(an,{})}),s.jsx("div",{className:"text-sm font-semibold select-none",children:f.format(e.toDate(i))}),s.jsx(q,{size:"md",className:S("text-muted",!a&&"invisible"),disabled:!a||x,"aria-hidden":!a,onClick:()=>{c("forward")},children:s.jsx(ha,{})})]})}function Cn({state:{timezone:e},startDate:t}){const{localeCode:a}=ne(),n=ee({weekday:"short"}),r=Ue(t,a);return s.jsx("div",{className:"flex",children:[...new Array(7).keys()].map(i=>{const l=r.add({days:i}).toDate(e),c=n.format(l);return s.jsx("div",{className:"w-40 h-40 text-sm font-semibold relative flex-shrink-0",children:s.jsx("div",{className:"absolute flex items-center justify-center w-full h-full select-none",children:c})},i)})})}function $t({state:e,visibleMonths:t=1}){return W()&&(t=1),s.jsx(u.Fragment,{children:[...new Array(t).keys()].map(n=>{const r=ye(be(e.calendarDates[n])),i=n===0,o=n===t-1;return s.jsx(Nn,{state:e,startDate:r,isFirst:i,isLast:o},n)})})}const Rt=u.memo(({start:e,end:t,options:a,preset:n})=>{const{dates:r}=Z(),i=ms(),o=ee(a||nt[n||(r==null?void 0:r.format)]);if(!e||!t)return null;let l;try{l=o.formatRange(qs(e,i),qs(t,i))}catch{l=""}return s.jsx(u.Fragment,{children:l})},rt);function qs(e,t){return typeof e=="string"?pa(e,t).toDate():"toDate"in e?e.toDate(t):e}function Dn({onPresetSelected:e,selectedValue:t}){return s.jsx(it,{children:St.map(a=>s.jsx(lt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(d,{...a.label})},a.key))})}const zt=[{key:0,label:I("Preceding period"),getRangeValue:e=>{const t=e.start,r=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:r}),end:t}}},{key:1,label:I("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:I("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function Pn({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(it,{children:zt.map(n=>s.jsx(lt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const r=n.getRangeValue(e);t(r)},children:s.jsx(d,{...n.label})},n.key))})}function Sn({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const r=nn(),{close:i}=xs(),o=u.useRef(e),l=e.isPlaceholder.start||e.isPlaceholder.end,[c,f]=u.useState(n),m=s.jsxs(Qe,{dividerTop:!0,startAction:!l&&!r?s.jsx("div",{className:"text-xs",children:s.jsx(Rt,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(V,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(o.current.selectedValue),e.setIsPlaceholder(o.current.isPlaceholder),i()},children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const x=e.selectedValue;t&&c&&(x.compareStart=t.selectedValue.start,x.compareEnd=t.selectedValue.end),i(x)},children:s.jsx(d,{message:"Select"})})]});return s.jsxs(Ce,{size:"auto",children:[s.jsxs(De,{className:"flex",padding:"p-0",children:[!r&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(Dn,{selectedValue:e.selectedValue,onPresetSelected:x=>{e.setSelectedValue(x),e.closeDialogOnSelection&&i(x)}}),!!t&&s.jsxs(u.Fragment,{children:[s.jsx(ot,{className:"mx-20 mb-10 mt-14",checked:c,onChange:x=>f(x.target.checked),children:s.jsx(d,{message:"Compare"})}),c&&s.jsx(Pn,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:x=>{t.setSelectedValue(x)}})]})]}),s.jsx(Ze,{initial:!1,children:s.jsx(An,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:c})})]}),!e.closeDialogOnSelection&&m]})}function An({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(se.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(Bs,{state:e}),!!t&&n&&s.jsx(Bs,{state:t,label:s.jsx(d,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx($t,{state:e,visibleMonths:2})})]})}function Bs({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(Tt,{className:"mb-20 mt-10",label:t,children:[s.jsx(cs,{state:e,value:a.start,onChange:r=>{n({...a,start:r})}}),s.jsx(gn,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(cs,{state:e,value:a.end,onChange:r=>{n({...a,end:r})}})]})}const xe=(e,t)=>{const a=e.split("/");return t&&a.push(t),a};function bi(e,t,a,n){return re({queryKey:xe(e,t),queryFn:({signal:r})=>Fn(e,t,n,r),placeholderData:Ye,...a})}async function Fn(e,t,a,n){t.query&&await new Promise(i=>setTimeout(i,300));const r=await L.get(e,{params:t,signal:t.query?n:void 0}).then(i=>i.data);return a==null||a(r),r}function Mt(e,t,a){return re({queryKey:[e,t],queryFn:()=>Tn(e,t),placeholderData:Ye,...a})}async function Tn(e,t){return L.get(e,{params:t}).then(a=>a.data)}function Lt(e,t,a){return re({queryKey:[e,t],queryFn:()=>Vn(e,t),...a})}async function Vn(e,t){return L.get(e,{params:t}).then(a=>a.data)}function $n({label:e,className:t,background:a,value:n,defaultValue:r="",placeholder:i=I("Select item..."),searchPlaceholder:o=I("Find an item..."),onChange:l,description:c,errorMessage:f,invalid:m,autoFocus:x,queryParams:p,endpoint:h,disabled:g,required:j}){var C;const y=u.useRef(null),[k,w]=u.useState(""),[A,D]=We(n,r,l),z=Mt(h,{query:k,...p}),{trans:O}=_(),b=us({size:"md"});return A?s.jsxs("div",{className:t,children:[s.jsx("div",{className:b.label,children:e}),s.jsx("div",{className:S("rounded-input border p-8",a,m&&"border-danger"),children:s.jsx(Ze,{initial:!1,mode:"wait",children:s.jsx(Rn,{disabled:g,endpoint:h,modelId:A,queryParams:p,onEditClick:()=>{D(""),w(""),requestAnimationFrame(()=>{var P,$;(P=y.current)==null||P.focus(),($=y.current)==null||$.click()})}})})}),c&&!f&&s.jsx("div",{className:b.description,children:c}),f&&s.jsx("div",{className:b.error,children:f})]}):s.jsx(ga,{className:t,showSearchField:!0,invalid:m,errorMessage:f,description:c,color:"white",isAsync:!0,background:a,placeholder:O(i),searchPlaceholder:O(o),label:e,isLoading:z.isFetching,items:(C=z.data)==null?void 0:C.results,inputValue:k,onInputValueChange:w,selectionMode:"single",selectedValue:A,onSelectionChange:D,ref:y,autoFocus:x,disabled:g,required:j,children:P=>s.jsx(hs,{value:P.id,description:P.description,startIcon:s.jsx(Is,{src:P.image}),children:P.name},P.id)})}function Rn({modelId:e,onEditClick:t,endpoint:a,disabled:n,queryParams:r}){const{data:i,isLoading:o}=Lt(`${a}/${e}`,r);return o||!(i!=null&&i.model)?s.jsx(zn,{},"skeleton"):s.jsxs(se.div,{className:S("flex items-center gap-10",n&&"pointer-events-none cursor-not-allowed text-disabled"),...ps,children:[i.model.image&&s.jsx(Is,{src:i.model.image}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm leading-4",children:i.model.name}),s.jsx("div",{className:"text-xs text-muted",children:i.model.description})]}),s.jsx(ke,{label:s.jsx(d,{message:"Change item"}),children:s.jsx(q,{className:"ml-auto text-muted",size:"sm",onClick:t,disabled:n,children:s.jsx(Ds,{})})})]},"preview")}function zn(){return s.jsxs(se.div,{className:"flex items-center gap-10",...ps,children:[s.jsx(pe,{variant:"rect",size:"w-32 h-32"}),s.jsxs("div",{className:"max-h-[36px] flex-auto",children:[s.jsx(pe,{className:"text-xs"}),s.jsx(pe,{className:"max-h-8 text-xs"})]}),s.jsx(pe,{variant:"icon",size:"w-24 h-24"})]})}function Mn({name:e,...t}){const{clearErrors:a}=Pe(),{field:{onChange:n,value:r=""},fieldState:{invalid:i,error:o}}=fs({name:e});return s.jsx($n,{value:r,onChange:l=>{n(l),a(e)},invalid:i,errorMessage:o==null?void 0:o.message,...t})}function ds(e){return{id:e,name:`${e}`,description:`${e}`}}function Ln(e,t){const a=u.useRef(null),n=et(t),{displayWith:r=E=>E.name,validateWith:i,children:o,suggestions:l,isLoading:c,inputValue:f,onInputValueChange:m,onItemSelected:x,placeholder:p,onOpenChange:h,chipSize:g="sm",openMenuOnFocus:j=!0,showEmptyMessage:y,value:k,defaultValue:w,onChange:A,valueKey:D,isAsync:z,allowCustomValue:O=!0,showDropdownArrow:b,onChipClick:C,...P}=e,$=us({...e,flexibleHeight:!0}),[K,B]=_n(e),[le,oe]=u.useState(!1),Y=s.jsx(gs,{isIndeterminate:!0,size:"sm","aria-label":"loading..."}),v=b?s.jsx(ka,{}):null,{fieldProps:N,inputProps:F}=st({...P,focusRef:n,endAdornment:c&&le?Y:v});return s.jsx(tt,{fieldClassNames:$,...N,children:s.jsxs(Ft,{ref:a,className:S("flex flex-wrap items-center",$.input),onClick:()=>{var E;(E=n.current)==null||E.focus()},children:[s.jsx(En,{displayChipUsing:r,onChipClick:C,items:K,setItems:B,chipSize:g}),s.jsx(Un,{size:e.size,showEmptyMessage:y,inputProps:F,inputValue:f,onInputValueChange:m,fieldRef:a,inputRef:n,chips:K,setChips:B,validateWith:i,isLoading:c,suggestions:l,placeholder:p,openMenuOnFocus:j,listboxIsOpen:le,setListboxIsOpen:oe,allowCustomValue:O,children:o})]})})}function En({items:e,setItems:t,displayChipUsing:a,chipSize:n,onChipClick:r}){const i=Ge(),o=u.useCallback(l=>{const c=e.findIndex(m=>m.id===l),f=[...e];return c>-1&&(f.splice(c,1),t(f)),f},[e,t]);return s.jsx(Nt,{className:S("max-w-full flex-shrink-0 flex-wrap",n==="xs"?"my-6":"my-8"),size:n,selectable:!0,children:e.map(l=>s.jsx(ct,{errorMessage:l.errorMessage,adornment:l.image?s.jsx(Is,{circle:!0,src:l.image}):null,onClick:()=>r==null?void 0:r(l),onRemove:()=>{o(l.id).length?i==null||i.focusPrevious({tabbable:!0}):i==null||i.focusLast()},children:a(l)},l.id))})}function Un(e){const{inputRef:t,fieldRef:a,validateWith:n,setChips:r,chips:i,suggestions:o,inputProps:l,placeholder:c,openMenuOnFocus:f,listboxIsOpen:m,setListboxIsOpen:x,allowCustomValue:p,isLoading:h,size:g}=e,j=Ge(),y=u.useCallback(v=>{v=(v||[]).filter(N=>{const F=!N||!N.id||!N.name;return!(i.findIndex(fe=>fe.id===(N==null?void 0:N.id))>-1)&&!F}),v.length&&(n&&(v=v.map(N=>n(N))),r([...i,...v]))},[i,r,n]),k=ja({...e,clearInputOnItemSelection:!0,isOpen:m,onOpenChange:x,items:o,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:v=>{B(v)}}),{state:{activeIndex:w,setActiveIndex:A,isOpen:D,setIsOpen:z,inputValue:O,setInputValue:b},refs:C,listboxId:P,collection:$,onInputChange:K}=k,B=v=>{const N=$.size&&w!=null?[...$.values()][w]:null;N!=null&&N.item?y([N.item]):p&&y([ds(N?N.value:v)]),b(""),A(null),z(!1)};ba(()=>{a.current&&C.reference.current!==a.current&&k.reference(a.current)},[a,k,C]);const{handleTriggerKeyDown:le,handleListboxKeyboardNavigation:oe}=wa(k),Y=Na(()=>{f&&!D&&z(!0)});return s.jsx(va,{listbox:k,mobileOverlay:ya,isLoading:h,onPointerDown:v=>{v.preventDefault()},children:s.jsx("input",{type:"text",className:S("mx-8 my-4 min-w-30 flex-[1_1_60px] bg-transparent text-sm outline-none",g==="xs"?"h-20":"h-30"),placeholder:c,...Ie(l,{ref:t,value:O,onChange:K,onPaste:v=>{const F=v.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(F){v.preventDefault();const E=window.getSelection();E!=null&&E.rangeCount&&(E.deleteFromDocument(),y(F.map(fe=>ds(fe))))}},"aria-autocomplete":"list","aria-controls":D?P:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:v=>{const N=v.target;if(v.key==="Enter"){v.preventDefault(),B(N.value);return}if(v.key==="Escape"&&D&&(z(!1),b("")),v.key==="ArrowUp"&&D&&(w===0||w==null)){A(null);return}if(w!=null&&(v.key==="ArrowLeft"||v.key==="ArrowRight")){v.preventDefault();return}if((v.key==="ArrowLeft"||v.key==="Backspace"||v.key==="Delete")&&N.selectionStart===0&&w==null&&i.length){j==null||j.focusPrevious({tabbable:!0});return}le(v)||oe(v)},onFocus:Y,onClick:Y})})})}function _n({onChange:e,value:t,defaultValue:a,valueKey:n}){const r=u.useMemo(()=>Ks(t),[t]),i=u.useMemo(()=>Ks(a),[a]),o=u.useCallback(l=>{const c=n?l.map(f=>f[n]):l;e==null||e(c)},[e,n]);return We(r||void 0,i||[],o)}function Ks(e){if(e!=null)return e.map(t=>typeof t!="object"?ds(t):t)}const On=Ke.forwardRef(Ln);function Et({children:e,...t}){const{field:{onChange:a,onBlur:n,value:r=[],ref:i},fieldState:{invalid:o,error:l}}=fs({name:t.name}),c={onChange:a,onBlur:n,value:r,invalid:o,errorMessage:l==null?void 0:l.message};return s.jsx(On,{ref:i,...Ie(c,t),children:e})}function Hn(e){const t=Te(),[a,n]=u.useState(!e.value&&!e.defaultValue),r=e.onChange,[i,o]=We(e.value||t,e.defaultValue||t,D=>{n(!1),r==null||r(D)}),{min:l,max:c,granularity:f,timezone:m,calendarIsOpen:x,setCalendarIsOpen:p,closeDialogOnSelection:h}=Vt(i,e),g=u.useCallback(()=>{n(!0),o(t),r==null||r(null),p(!1)},[t,o,r,p]),[j,y]=u.useState(()=>[ye(i)]),k=u.useCallback(D=>{l&&D.compare(l)<0?D=l:c&&D.compare(c)>0&&(D=c);const z=i?i.set(D):X(D,m);o(z),y([ye(z)]),n(!1)},[o,l,c,i,m]),w=u.useCallback(D=>!a&&he(i,D),[i,a]),A=u.useCallback(D=>({onClick:()=>{k==null||k(D),h&&(p==null||p(!1))}}),[k,p,h]);return{selectedValue:i,setSelectedValue:o,calendarIsOpen:x,setCalendarIsOpen:p,dayIsActive:w,dayIsHighlighted:()=>!1,dayIsRangeStart:()=>!1,dayIsRangeEnd:()=>!1,getCellProps:A,calendarDates:j,setCalendarDates:y,isPlaceholder:a,clear:g,setIsPlaceholder:n,min:l,max:c,granularity:f,timezone:m,closeDialogOnSelection:h}}function qn({showCalendarFooter:e,...t}){const a=Hn(t),n=u.useRef(null),r=Te(),i=e&&s.jsx(Qe,{padding:"px-14 pb-14",startAction:s.jsx(V,{disabled:a.isPlaceholder,variant:"text",color:"primary",onClick:()=>{a.clear()},children:s.jsx(d,{message:"Clear"})}),children:s.jsx(V,{variant:"text",color:"primary",onClick:()=>{a.setSelectedValue(r),a.setCalendarIsOpen(!1)},children:s.jsx(d,{message:"Today"})})}),o=s.jsx(te,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:n,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsxs(Ce,{size:"auto",children:[s.jsx(De,{className:"flex items-start gap-40",padding:e?"px-24 pt-20 pb-10":null,children:s.jsx($t,{state:a,visibleMonths:1})}),i]})}),l={onClick:c=>{c.stopPropagation(),c.preventDefault(),Kn(c)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}};return s.jsxs(u.Fragment,{children:[s.jsx(Tt,{ref:n,wrapperProps:l,endAdornment:s.jsx(At,{className:S(t.disabled&&"text-disabled")}),...t,children:s.jsx(cs,{segmentProps:l,state:a,value:a.selectedValue,onChange:a.setSelectedValue,isPlaceholder:a.isPlaceholder})}),o]})}function Bn(e){const{min:t,max:a}=e,{trans:n}=_(),{format:r}=ee(),{field:{onChange:i,onBlur:o,value:l=null,ref:c},fieldState:{invalid:f,error:m}}=fs({name:e.name,rules:{validate:h=>{if(!h)return;const g=_e(h);if(t&&g.compare(t)<0)return n({message:"Enter a date after :date",values:{date:r(h)}});if(a&&g.compare(a)>0)return n({message:"Enter a date before :date",values:{date:r(h)}})}}}),x=l?_e(l):null,p={onChange:h=>{i(h&&h.toAbsoluteString())},onBlur:o,value:x,invalid:f,errorMessage:m==null?void 0:m.message,inputRef:c};return s.jsx(qn,{...Ie(p,e)})}function Kn(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}const Wn=Q(s.jsx("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandleOutlined");function Gn(){const[e,t]=u.useState(!1),a=u.useRef(),n=u.useCallback(r=>{var i;if(r){const o=new IntersectionObserver(([l])=>t(l.intersectionRatio<1),{threshold:[1]});a.current=o,o.observe(r)}else a.current&&((i=a.current)==null||i.disconnect())},[]);return{isSticky:e,sentinelRef:n}}function Ve({onSubmit:e,form:t,title:a,subTitle:n,children:r,actions:i,backButton:o,isLoading:l=!1,disableSaveWhenNotDirty:c=!1,wrapInContainer:f=!0}){const{isSticky:m,sentinelRef:x}=Gn(),p=c?Object.keys(t.formState.dirtyFields).length:!0;return s.jsxs(Se,{onSubmit:e,onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx("div",{ref:x}),s.jsx("div",{className:S("sticky top-0 z-10 my-12 transition-shadow md:my-24",m&&"bg shadow"),children:s.jsxs("div",{className:S("flex items-center gap-24 py-14 md:items-start",f&&"container mx-auto px-24"),children:[o,s.jsxs("div",{className:"overflow-hidden overflow-ellipsis md:mr-64",children:[s.jsx("h1",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-xl md:text-3xl",children:a}),n&&s.jsx("div",{className:"mt-4",children:n})]}),s.jsx("div",{className:"mr-auto"}),i,s.jsx(V,{variant:"flat",color:"primary",type:"submit",disabled:l||!p,children:s.jsx(d,{message:"Save"})})]})}),s.jsx("div",{className:f?"container mx-auto px-24 pb-24":void 0,children:s.jsx("div",{className:"rounded",children:r})})]})}const Ut=""+new URL("music-cae87f73.svg",import.meta.url).href;function Qn(e){return re({queryKey:["artists","search-suggestions",e],queryFn:()=>Zn(e),placeholderData:Ye})}async function Zn(e){return L.get("search/suggestions/artist",{params:e}).then(t=>t.data)}function _t({name:e,className:t}){const{trans:a}=_(),[n,r]=u.useState(""),{data:i,isLoading:o}=Qn({query:n});return s.jsx(Et,{className:t,name:e,label:s.jsx(d,{message:"Artists"}),isAsync:!0,inputValue:n,onInputValueChange:r,suggestions:i==null?void 0:i.results,placeholder:a(I("+Add artist")),isLoading:o,allowCustomValue:!1,children:i==null?void 0:i.results.map(l=>s.jsx(hs,{value:l,startIcon:l.image?s.jsx("img",{className:"rounded-full object-cover w-24 h-24",src:l.image,alt:""}):void 0,children:l.name},l.id))})}function we({name:e,label:t,placeholder:a,model:n,className:r,allowCustomValue:i=!1}){const[o,l]=u.useState(""),{data:c,isLoading:f}=Mt(`normalized-models/${n}`,{query:o});return s.jsx(Et,{className:r,name:e,label:t,isAsync:!0,inputValue:o,onInputValueChange:l,suggestions:c==null?void 0:c.results,placeholder:a,isLoading:f,allowCustomValue:i,children:c==null?void 0:c.results.map(m=>s.jsx(hs,{value:m,startIcon:m.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:m.image,alt:""}):void 0,children:m.name},m.id))})}const Ot="tag",Ht=Q(s.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z"}),"FileUploadOutlined");function qt({fileUpload:e,status:t,className:a}){const n=(e==null?void 0:e.bytesUploaded)||0,r=u.useMemo(()=>Ms(e.file.size),[e.file.size]),i=u.useMemo(()=>Ms(n),[n]);let o;return t==="completed"?o=s.jsx(d,{message:"Upload complete"}):t==="aborted"?o=s.jsx(d,{message:"Upload cancelled"}):t==="failed"?o=s.jsx(d,{message:"Upload failed"}):t==="processing"?o=s.jsx(d,{message:"Processing upload..."}):t==="pending"?o=s.jsx(d,{message:"Waiting to start..."}):o=s.jsx(d,{message:":bytesUploaded of :totalBytes uploaded",values:{bytesUploaded:i,totalBytes:r}}),s.jsx("div",{className:S("text-muted text-xs",a),children:o})}function Bt({fileUpload:e,status:t,onAbort:a,size:n="md",className:r}){return s.jsxs("div",{className:r,children:[s.jsxs("div",{className:"flex items-center gap-24 justify-between",children:[s.jsx(qt,{fileUpload:e,status:t}),s.jsx(Yn,{fileUpload:e,status:t,onAbort:a})]}),s.jsx(Ia,{size:n==="sm"?"xs":"sm",radius:"rounded-sm",value:e.percentage,isIndeterminate:t==="processing"||t==="pending"})]})}function Yn({fileUpload:e,status:t,onAbort:a}){R(i=>i.abortUpload),R(i=>i.clearInactive);const n=e.errorMessage;let r;if(t==="failed"){const i=n||I("This file could not be uploaded");r=s.jsx(Me,{children:s.jsx(ke,{variant:"danger",label:s.jsx(Ca,{value:i}),children:s.jsx(Da,{className:"text-danger",size:"sm"})})})}else t==="aborted"?r=s.jsx(Me,{children:s.jsx(Pa,{className:"text-warning",size:"sm"})}):t==="completed"||t==="processing"?r=s.jsx(Me,{children:s.jsx(Sa,{size:"sm",className:"text-primary"})}):a?r=s.jsx(Me,{children:s.jsx(q,{size:"xs",onClick:()=>a(e.file.id),children:s.jsx(js,{})})}):r=s.jsx("div",{className:"w-30 h-30"});return s.jsx(Ze,{children:r})}function Me({children:e,...t}){return s.jsx(se.div,{className:"flex w-30 h-30 items-center justify-center",...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function Jn(){return ce({mutationFn:e=>Xn(e),onError:e=>Aa(e)})}function Xn(e){return L.post(`tracks/${e.fileEntryId}/extract-metadata`,e).then(t=>er(t.data))}function er(e){const t={name:e.metadata.title,duration:e.metadata.duration,genres:e.metadata.genres||[],description:e.metadata.comment,lyric:e.metadata.lyrics,release_date:e.metadata.release_date,album_name:e.metadata.album_name};return e.metadata.album&&(t.album_id=e.metadata.album.id),e.metadata.artist&&(t.artists=[e.metadata.artist]),e.metadata.image&&(t.image=e.metadata.image.url),t}function Kt(e,t){var a,n;!((a=e.getValues("artists"))!=null&&a.length)&&t.artists&&e.setValue("artists",t.artists),!e.getValues("image")&&t.image&&e.setValue("image",t.image),t.release_date&&e.setValue("release_date",t.release_date),(n=t.genres)!=null&&n.length&&e.setValue("genres",Ee(e.getValues("genres"),t.genres)),!e.getValues("name")&&t.album_name&&e.setValue("name",t.album_name)}function Ne(e,t){return{...t,...e,artists:Ee(t.artists,e.artists),genres:Ee(t.genres,e.genres,"name"),tags:Ee(t.tags,e.tags,"name")}}function Ee(e=[],t=[],a="id"){return t=t.filter(n=>!e.find(r=>r[a]===n[a])),[...e,...t]}const sr=50*1024*1024;function ts(e){const{uploads:t}=Z(),a=u.useMemo(()=>({allowedFileTypes:[Ls.audio,Ls.video],maxFileSize:t.max_size||sr}),[t.max_size]),n=Jn(),r=u.useRef(e);r.current=e;const i=R(h=>h.uploadMultiple),o=R(h=>h.updateFileUpload),l=R(h=>h.getUpload),c=u.useCallback((h,g)=>{var j;o(h,{meta:{...((j=l(h))==null?void 0:j.meta)||{},...g}})},[o,l]),f=u.useMemo(()=>({metadata:{diskPrefix:"track_media",disk:Fa.public},restrictions:a,onSuccess:(h,g)=>{c(g.id,{isExtractingMetadata:!0}),n.mutate({fileEntryId:h.id,autoMatchAlbum:r.current.autoMatchAlbum},{onSuccess:j=>{c(g.id,{isExtractingMetadata:!1});const y={...j,src:h.url};r.current.onMetadataChange(g,y)},onError:()=>{c(g.id,{isExtractingMetadata:!1})}})},onError:h=>{h&&ae.danger(h)}}),[n,c,a]),m=u.useCallback(h=>{const g=h.filter(j=>!Ta(j,a));return h.length!==g.length&&ae.danger(I(":count of your files is not supported.",{values:{count:h.length-g.length}})),g},[a]),x=u.useCallback(async h=>{if(m(h).length){h.forEach(j=>{var y,k;(k=(y=r.current).onUploadStart)==null||k.call(y,{name:j.name,uploadId:j.id})}),i(h,f);for(const j of h){c(j.id,{isGeneratingWave:!0});const y=await rn(j.native);y&&r.current.onMetadataChange(j,{waveData:y}),c(j.id,{isGeneratingWave:!1})}}},[f,i,c,m]);return{openFilePicker:u.useCallback(async()=>{const h=await Va({multiple:!0,types:a.allowedFileTypes});await x(h)},[x,a]),uploadTracks:x,validateUploads:m}}function Ps(e){const t=R(r=>e?r.fileUploads.get(e):null);let a=!1,n;if(t){const r=t.meta,i=(r==null?void 0:r.isExtractingMetadata)||(r==null?void 0:r.isGeneratingWave);a=(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="inProgress"||!!i,n=(t==null?void 0:t.status)==="completed"&&i?"processing":t==null?void 0:t.status}return{isUploading:a,status:n,activeUpload:t}}function tr(){const[e,t]=u.useState(),{setValue:a,watch:n,getValues:r}=Pe(),{openFilePicker:i}=ts({onUploadStart:({uploadId:x})=>t(x),onMetadataChange:(x,p)=>{const h=Ne(p,r());Object.entries(h).forEach(([g,j])=>a(g,j,{shouldDirty:!0}))}}),{status:o,isUploading:l,activeUpload:c}=Ps(e),{abortUpload:f,clearInactive:m}=R();return s.jsxs("div",{children:[s.jsx(V,{className:"w-full",variant:"flat",color:"primary",startIcon:s.jsx(Ht,{}),disabled:l,onClick:()=>i(),children:n("src")?s.jsx(d,{message:"Replace file"}):s.jsx(d,{message:"Upload file"})}),c&&s.jsx(Bt,{fileUpload:c,status:o,className:"mt-24",onAbort:x=>{f(x),m()}})]})}function $e({showExternalIdFields:e,showAlbumField:t=!0,uploadButton:a}){const{trans:n}=_(),r=W();return s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image",diskPrefix:"track_image",variant:r?"input":"square",label:r?s.jsx(d,{message:"Image"}):null,previewSize:r?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),s.jsx("div",{className:"mt-24",children:a||s.jsx(tr,{})})]}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),t&&s.jsx(Mn,{className:"mb-24",label:s.jsx(d,{message:"Album"}),name:"album_id",endpoint:"search/suggestions/album"}),s.jsx(_t,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:n(I("+Add genre")),model:Cs,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:n(I("+Add tag")),model:Ot,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),s.jsx(rr,{}),e&&s.jsx(ar,{}),e&&s.jsx(nr,{})]})]})}function ar(){return s.jsx(M,{name:"src",label:s.jsx(d,{message:"Playback source"}),className:"mb-24",minLength:1,maxLength:230,description:s.jsx(d,{message:"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically."})})}function nr(){const{spotify_is_setup:e}=Z();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function rr(){const{watch:e}=Pe();return s.jsx(M,{required:!0,name:"duration",label:s.jsx(d,{message:"Duration (in milliseconds)"}),className:"mb-24",type:"number",min:1,max:864e5,description:s.jsx(d,{message:"Will appear on the site as: :preview",values:{preview:s.jsx(ln,{ms:e("duration")})}})})}const Wt="tracks";function Gt(e,{onSuccess:t}={}){const{trans:a}=_();return ce({mutationFn:n=>ir(n),onSuccess:n=>{ae(a(I("Track created"))),de.invalidateQueries({queryKey:xe(Wt)}),t==null||t(n)},onError:n=>Ae(n,e)})}function ir(e){return L.post(Wt,Ss(e)).then(t=>t.data)}function Ss(e){var t;return{...e,album_id:e.album_id?e.album_id:null,artists:(t=e.artists)==null?void 0:t.map(a=>a.id)}}function Qt({onTrackCreated:e,defaultValues:t}={}){const a=ie({defaultValues:t}),n=Gt(a,{onSuccess:e});return{form:a,createTrack:n}}function vi({wrapInContainer:e}){const t=Fe(),{pathname:a}=ue(),{form:n,createTrack:r}=Qt({onTrackCreated:i=>{a.includes("admin")?t(`/admin/tracks/${i.track.id}/edit`):t(Oe(i.track))}});return s.jsx(Ve,{form:n,onSubmit:i=>{r.mutate(i)},title:s.jsx(d,{message:"Add new track"}),isLoading:r.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})})}const lr=e=>`tracks/${e}`;function or(e,t={}){const{trans:a}=_();return ce({mutationFn:n=>cr(n),onSuccess:n=>{var r;ae(a(I("Track updated"))),de.invalidateQueries({queryKey:xe("tracks")}),(r=t.onSuccess)==null||r.call(t,n)},onError:n=>Ae(n,e)})}function cr({id:e,...t}){return L.put(lr(e),Ss(t)).then(a=>a.data)}function Zt(e,t={}){var r;const a=ie({defaultValues:{...e,image:e.image||((r=e.album)==null?void 0:r.image)}}),n=or(a,{onSuccess:t.onTrackUpdated});return{form:a,updateTrack:n}}function yi({wrapInContainer:e}){const t=It({loader:"editTrackPage"});return t.data?s.jsx(dr,{track:t.data.track,wrapInContainer:e}):s.jsx(bs,{query:t,loaderClassName:"absolute inset-0 m-auto",loaderIsScreen:!1})}function dr({track:e,wrapInContainer:t}){const{canEdit:a}=$a([e]),n=Fe(),{pathname:r}=ue(),{form:i,updateTrack:o}=Zt(e,{onTrackUpdated:l=>{r.includes("admin")?n("/admin/tracks"):n(Oe(l.track))}});return a?s.jsx(Ve,{form:i,onSubmit:l=>{o.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}}),isLoading:o.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})}):s.jsx(vs,{to:"/",replace:!0})}const Yt="albums";function Jt(e){const{trans:t}=_();return ce({mutationFn:a=>ur(a),onSuccess:()=>{ae(t(I("Album created"))),de.invalidateQueries({queryKey:xe(Yt)})},onError:a=>Ae(a,e)})}function ur(e){return L.post(Yt,Xt(e)).then(t=>t.data)}function Xt(e){var t,a;return{...e,artists:(t=e.artists)==null?void 0:t.map(n=>n.id),tracks:(a=e.tracks)==null?void 0:a.map(n=>Ss(n))}}const mr=e=>`albums/${e}`;function xr(e,t){const{trans:a}=_(),n=Fe(),{pathname:r}=ue();return ce({mutationFn:i=>fr(t,i),onSuccess:i=>{ae(a(I("Album updated"))),de.invalidateQueries({queryKey:xe("albums")}),r.includes("admin")?n("/admin/albums"):n(He(i.album))},onError:i=>Ae(i,e)})}function fr(e,t){return L.put(mr(e),Xt(t)).then(a=>a.data)}function hr({track:e,hideAlbumField:t}){const{formId:a,close:n}=xs(),{form:r}=Zt(e);return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ys,{children:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Qe,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Update"})})]})]})}function pr({defaultValues:e,hideAlbumField:t}){const{formId:a,close:n}=xs(),{form:r}=Qt({defaultValues:e});return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ys,{children:s.jsx(d,{message:"Add new track"})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Qe,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Create"})})]})]})}function gr(){const e=Pe(),{watch:t,setValue:a,getValues:n}=e,{fields:r,remove:i,prepend:o,move:l}=dt({name:"tracks"}),c=(x,p)=>{var g;const h=(g=n("tracks"))==null?void 0:g.findIndex(j=>j.uploadId===x);h!=null&&a(`tracks.${h}`,Ne(p,n(`tracks.${h}`)),{shouldDirty:!0})},{openFilePicker:f}=ts({onUploadStart:x=>o(Ne(x,{artists:e.getValues("artists"),genres:e.getValues("genres"),tags:e.getValues("tags")})),onMetadataChange:(x,p)=>{Kt(e,p),c(x.id,p)}}),m=t("tracks")||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"my-24 text-xl font-semibold",children:s.jsx(d,{message:"Tracks"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Ht,{}),onClick:()=>f(),children:s.jsx(d,{message:"Upload tracks"})}),s.jsxs(te,{type:"modal",onClose:x=>{x&&o(x)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Create track"}),children:s.jsx(q,{variant:"outline",color:"primary",size:"xs",children:s.jsx(ks,{})})}),s.jsx(pr,{hideAlbumField:!0,defaultValues:{artists:t("artists"),tags:t("tags"),genres:t("genres")}})]})]}),r.map((x,p)=>{const h=m[p];return s.jsx(jr,{track:h,onRemove:()=>i(p),onSort:(g,j)=>l(g,j),tracks:m,onUpdate:g=>{c(h.uploadId,g)}},x.id)}),r.length?null:s.jsx(ut,{className:"mt-40",image:s.jsx(mt,{src:Ut}),title:s.jsx(d,{message:"This album does not have any tracks yet"})})]})}function jr({track:e,tracks:t,onRemove:a,onUpdate:n,onSort:r}){const i=u.useRef(null),o=u.useRef(null),l=R(p=>p.abortUpload),c=R(p=>e.uploadId?p.fileUploads.get(e.uploadId):null),{isUploading:f,status:m}=Ps(e.uploadId),{sortableProps:x}=cn({disabled:f,ref:i,item:e,items:t,type:"albumFormTrack",preview:o,strategy:"line",onSortEnd:(p,h)=>{r(p,h)}});return s.jsxs("div",{className:"border-b border-t border-t-transparent py-4",ref:i,...x,children:[s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(q,{className:"mr-14 flex-shrink-0",disabled:f,children:s.jsx(Wn,{})}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),c&&s.jsxs("div",{className:"mr-10 flex items-center",children:[s.jsx(qt,{fileUpload:c,status:m,className:"mr-10"}),s.jsx(gs,{isIndeterminate:m==="processing",value:c.percentage,size:"sm"})]}),s.jsxs(te,{type:"modal",onClose:p=>{p&&n(p)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Edit track"}),children:s.jsx(q,{className:"ml-auto flex-shrink-0 text-muted",disabled:f,children:s.jsx(Ds,{})})}),s.jsx(hr,{track:e,hideAlbumField:!0})]}),s.jsxs(te,{type:"modal",onClose:p=>{p&&(e.uploadId&&l(e.uploadId),a())},children:[s.jsx(ke,{label:s.jsx(d,{message:"Remove track"}),children:s.jsx(q,{className:"flex-shrink-0 text-muted",children:s.jsx(js,{})})}),s.jsx(xt,{isDanger:!0,title:s.jsx(d,{message:"Remove track"}),body:s.jsx(d,{message:"Are you sure you want to remove this track from the album?"}),confirm:s.jsx(d,{message:"Remove"})})]})]}),s.jsx(br,{track:e,ref:o})]})}const br=Ke.forwardRef(({track:e},t)=>{var n,r;let a=e.name;return(n=e.artists)!=null&&n.length&&(a+=`- ${(r=e.artists)==null?void 0:r[0].name}`),s.jsx(on,{ref:t,children:()=>s.jsx("div",{className:"rounded bg-chip p-8 text-sm shadow",children:a})})});function As({showExternalIdFields:e}){const{trans:t}=_(),a=W();return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Je,{name:"image",diskPrefix:"album_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:"md:w-full md:w-224 md:aspect-square",stretchPreview:!0})}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),s.jsx(Bn,{name:"release_date",label:s.jsx(d,{message:"Release date"}),className:"mb-24",granularity:"day"}),s.jsx(_t,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:Cs,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:t(I("+Add tag")),model:Ot,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),e&&s.jsx(vr,{})]})]}),s.jsx(gr,{})]})}function vr(){const{spotify_is_setup:e}=Z();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function ki({wrapInContainer:e}){const t=Ct({loader:"editAlbumPage"});return t.data?s.jsx(me,{children:s.jsx(yr,{album:t.data.album,wrapInContainer:e})}):s.jsx(bs,{query:t,loaderIsScreen:!1,loaderClassName:"absolute inset-0 m-auto"})}function yr({album:e,wrapInContainer:t}){const{canEdit:a}=Ra(e),n=!!R(o=>o.activeUploadsCount),r=ie({defaultValues:{image:e.image,name:e.name,release_date:e.release_date,artists:e.artists,genres:e.genres,tags:e.tags,description:e.description,spotify_id:e.spotify_id,tracks:e.tracks}}),i=xr(r,e.id);return a?s.jsx(Ve,{form:r,onSubmit:o=>{i.mutate(o)},title:s.jsx(d,{message:"Edit “:name“ album",values:{name:e.name}}),isLoading:i.isPending||n,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(As,{showExternalIdFields:!0})}):s.jsx(vs,{to:"/",replace:!0})}const kr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=ft(),i=Te(),[o,l]=u.useState(!1),c=ie({defaultValues:{tracks:[],artists:r?[r]:[],release_date:i.toAbsoluteString()}}),f=c.watch("tracks")||[],m=R(y=>y.abortUpload),x=!!R(y=>y.activeUploadsCount),{openFilePicker:p,uploadTracks:h,validateUploads:g}=ts({onUploadStart:y=>{l(!0),c.setValue("tracks",[...c.getValues("tracks"),y]),e()},onMetadataChange:(y,k)=>{Kt(c,k),c.setValue("tracks",c.getValues("tracks").map(w=>w.uploadId===y.id?Ne(k,w):w))}});u.useImperativeHandle(n,()=>({openFilePicker:p,uploadTracks:h,validateUploads:g}),[p,h,g]);const j=Jt(c);return o?s.jsxs(Se,{className:"rounded border p-14 md:p-24 mb-30 bg-background",form:c,onSubmit:y=>j.mutate(y,{onSuccess:k=>{l(!1),c.reset(),a(k.album)}}),children:[s.jsx(As,{showExternalIdFields:!1}),s.jsxs("div",{className:"mt-24",children:[s.jsx(V,{variant:"text",onClick:()=>{f.forEach(y=>{m(y.uploadId)}),c.reset(),l(!1),t()},className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:x||j.isPending,children:s.jsx(d,{message:"Save"})})]})]}):null}),wr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=ft(),i=R(x=>x.abortUpload),[o,l]=u.useState([]),{openFilePicker:c,uploadTracks:f,validateUploads:m}=ts({onUploadStart:x=>{l(p=>r?[...p,{...x,artists:[r]}]:[...p,x]),e()},onMetadataChange:(x,p)=>{l(h=>h.map(g=>g.uploadId===x.id?Ne(p,g):g))}});return u.useImperativeHandle(n,()=>({openFilePicker:c,uploadTracks:f,validateUploads:m}),[c,f,m]),s.jsx("div",{className:"w-full",children:o.map(x=>s.jsx(Nr,{track:x,onCreate:p=>{l(h=>h.filter(g=>g.uploadId!==x.uploadId)),a(p)},onRemove:()=>{l(p=>{const h=p.filter(g=>g.uploadId!==x.uploadId);return h.length||t(),h}),i(x.uploadId)}},x.uploadId))})}),Nr=u.memo(({track:e,onRemove:t,onCreate:a})=>{const n=ie({defaultValues:e}),r=Gt(n),i=R(f=>f.fileUploads.get(e.uploadId)),{isUploading:o,status:l}=Ps(e.uploadId);u.useEffect(()=>{n.reset(e)},[e,n]);const c=o&&i?s.jsx(Bt,{fileUpload:i,status:l}):null;return s.jsxs(Se,{form:n,onSubmit:f=>{r.mutate(f,{onSuccess:m=>a(m.track)})},className:"rounded border p-14 md:p-24 mb-30 bg-background",children:[s.jsx($e,{uploadButton:c,showExternalIdFields:!1}),s.jsx(V,{variant:"text",onClick:()=>t(),className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:r.isPending||!n.watch("src"),children:s.jsx(d,{message:"Save"})})]})}),Ir=""+new URL("album-border-b5dd7d9f.png",import.meta.url).href;function Cr({media:e}){var n,r;const t=e.model_type===za,a=t?He(e,{absolute:!0}):Oe(e,{absolute:!0});return s.jsxs("div",{className:"flex items-center gap-28 border rounded bg-background p-20 my-20 mx-auto w-780 max-w-full",children:[s.jsxs("div",{className:S(t&&"relative isolate my-14 mx-18"),children:[t?s.jsx(Xe,{album:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}):s.jsx(ws,{track:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}),t&&s.jsx("img",{className:"absolute block w-160 h-160 max-w-160 -top-14 -left-14 z-10",src:Ir,alt:""})]}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:"text-base font-bold",children:e.name}),s.jsx("div",{className:"text-muted text-sm mb-14",children:s.jsx(es,{artists:e.artists})}),(n=e.genres)!=null&&n.length?s.jsx(Nt,{selectable:!1,size:"sm",className:"mb-14",children:(r=e.genres)==null?void 0:r.map(i=>s.jsx(ct,{children:i.display_name||i.name},i.id))}):null,s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Upload complete. <a>Go to your track</a>",values:{a:i=>s.jsx(J,{className:ht,to:t?He(e):Oe(e),children:i})}})})]}),s.jsx("div",{className:"ml-auto flex-auto max-w-300",children:s.jsxs("div",{className:"text-muted text-sm",children:[s.jsx(d,{message:"Share your new track"}),s.jsx(Ma,{name:e.name,image:e.image,link:a}),s.jsx(La,{value:a,readOnly:!0,className:"mt-24 w-full",size:"sm",onClick:i=>{i.target.select()}})]})})]})}function Dr({isVisible:e}){const t=s.jsx(se.div,{...ps,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:s.jsx(se.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:s.jsx(d,{message:"Drop your files anywhere on the page to upload"})})},"dragTargetMask");return s.jsx(Ze,{children:e?t:null})}function Pr(){const{user:e}=je();e!=null&&e.id&&de.resetQueries({queryKey:["minutesLimit",e.id]})}function Sr(){const{user:e}=Ea(),t=e==null?void 0:e.id;return re({queryKey:["minutesLimit",t],queryFn:()=>Ar(t),enabled:t!=null})}function Ar(e){return L.get(`users/${e}/minutes-left`).then(t=>t.data)}function Fr({children:e,...t}){Ua();const{player:a}=Z();return W(),s.jsx("div",{className:"flex h-screen flex-col",...t,children:s.jsxs(pt,{name:"web-player",initialRightSidenavStatus:a!=null&&a.hide_queue?"closed":"open",children:[s.jsx(gt,{size:"sm",menuPosition:"pricing-table-page",className:"flex-shrink-0"}),s.jsx(jt,{position:"left",display:"block",children:s.jsx(bt,{})}),s.jsx(vt,{children:s.jsx("div",{className:"relative flex-auto overflow-y-auto",children:s.jsx("div",{className:"container mx-auto flex min-h-full flex-col p-14 md:p-24",children:s.jsx("div",{className:"flex-auto",children:e})})})})]})})}function wi({backstageLayout:e=!0}){return s.jsx(me,{children:s.jsx(Tr,{backstageLayout:e})})}function Tr({backstageLayout:e}){const[t,a]=u.useState("tracks"),[n,r]=u.useState(!1),i=u.useRef(null),o=t==="tracks"?wr:kr,[l,c]=u.useState([]),f=u.useRef(null),[m,x]=u.useState(!1),{droppableProps:p}=dn({id:"uploadPageRoot",ref:f,types:["nativeFile"],onDragEnter:()=>x(!0),onDragLeave:()=>x(!1),onDrop:async g=>{var j,y;if(g.type==="nativeFile"){const k=await g.getData(),w=(j=i.current)==null?void 0:j.validateUploads(k);w!=null&&w.length&&((y=i.current)==null||y.uploadTracks(w))}}}),h=e?Fr:$r;return s.jsxs(h,{...p,children:[!n&&s.jsx(Vr,{onUpload:()=>{var g;return(g=i.current)==null?void 0:g.openFilePicker()},uploadMode:t,onUploadModeChange:a}),l.map(g=>s.jsx(Cr,{media:g},g.id)),s.jsx(o,{ref:i,onUploadStart:()=>r(!0),onCreate:g=>{c(j=>[...j,g]),Pr()},onCancel:()=>{r(!1)}}),s.jsx(Dr,{isVisible:m})]})}function Vr({onUpload:e,uploadMode:t,onUploadModeChange:a}){const{data:n}=Sr();return s.jsxs("div",{className:"pt-40",children:[s.jsxs("div",{className:"border rounded p-20 md:p-48 flex flex-col items-center max-w-580 mx-auto bg-background",children:[s.jsx("h1",{className:"text-base md:text-[22px] md:font-light",children:s.jsx(d,{message:"Drag and drop your tracks, videos & albums here."})}),s.jsx(V,{variant:"flat",color:"primary",className:"mt-20 w-min",onClick:()=>e(),children:s.jsx(d,{message:"Or choose files to upload"})}),s.jsx("div",{className:"border-t pt-20 mt-20",children:s.jsx(ot,{checked:t==="album",onChange:r=>a(r.target.checked?"album":"tracks"),children:s.jsx(d,{message:"Make an album when multiple files are selected"})})})]}),s.jsx("div",{className:"text-muted mt-20 text-sm text-center min-h-20",children:(n==null?void 0:n.minutesLeft)!=null&&s.jsx(d,{message:"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.",values:{count:n.minutesLeft,a:r=>s.jsx(J,{className:ht,to:"/pricing",children:r})}})})]})}function $r({children:e,...t}){return s.jsx("div",{...t,className:"min-h-full relative",children:s.jsx("div",{className:"container mx-auto p-14 md:p-24",children:e})})}function Ni({wrapInContainer:e}){return s.jsx(me,{children:s.jsx(Rr,{wrapInContainer:e})})}function Rr({wrapInContainer:e}){const t=!!R(m=>m.activeUploadsCount),a=Te(),n=Fe(),{pathname:r}=ue(),[i]=_a(),{data:o}=Lt(`normalized-models/artist/${i.get("artistId")}`,void 0,{enabled:!!i.get("artistId")}),l=o==null?void 0:o.model,c=ie({defaultValues:{release_date:a.toAbsoluteString()}}),f=Jt(c);return u.useEffect(()=>{l&&c.reset({artists:[l]})},[l,c]),s.jsx(Ve,{form:c,onSubmit:m=>{f.mutate(m,{onSuccess:x=>{r.includes("admin")?n(l?`/admin/artists/${l.id}/edit`:"/admin/albums"):n(He(x.album))}})},title:s.jsx(d,{message:"Add new album"}),isLoading:f.isPending||t,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(As,{showExternalIdFields:!0})})}function Ii(){const{requestId:e}=ss();return re({queryKey:["backstage-request",+e],queryFn:()=>zr(e)})}function zr(e){return L.get(`backstage-request/${e}`).then(t=>t.data)}const Ci=Q(s.jsx("path",{d:"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z"}),"DocumentScannerOutlined"),ea=Q(s.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger"),Mr=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3",body:e=>s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx(Xe,{album:e,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),s.jsx(Ns,{album:e,target:"_blank"})]})},{key:"release_date",allowsSorting:!0,header:()=>s.jsx(d,{message:"Release date"}),body:e=>e.release_date?s.jsx(Oa,{date:e.release_date}):null},{key:"track_count",allowsSorting:!1,header:()=>s.jsx(d,{message:"Track count"}),body:e=>e.tracks_count?s.jsx(qe,{value:e.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>s.jsx(d,{message:"Plays"}),body:e=>e.plays?s.jsx(qe,{value:e.plays}):null},{key:"actions",header:()=>s.jsx(d,{message:"Actions"}),width:"w-84 flex-shrink-0",visibleInMode:"all",hideHeader:!0,align:"end",body:e=>s.jsx(Er,{album:e})}];function Lr({albums:e=[]}){const{watch:t}=Pe(),a=t("id"),{data:n,sortDescriptor:r,onSortChange:i}=un(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"my-24",children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold",children:s.jsx(d,{message:"Albums"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(ks,{}),elementType:a?J:void 0,to:`../../../albums/new?artistId=${a}`,relative:"path",disabled:!a,children:s.jsx(d,{message:"Add album"})})]}),!a&&s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsx(ea,{viewBox:"0 0 16 16",size:"xs",className:"text-muted"}),s.jsx(d,{message:"Save changes to enable album creation."})]})]}),s.jsx(mn,{columns:Mr,data:e,sortDescriptor:r,onSortChange:i,enableSelection:!1}),n.length?null:s.jsx(ut,{className:"mt-40",image:s.jsx(mt,{src:Ut}),title:s.jsx(d,{message:"This artist does not have any albums yet"})})]})}function Er({album:e}){const t=Ha();return s.jsxs("div",{className:"text-muted",children:[s.jsx(J,{to:`../../../albums/${e.id}/edit`,relative:"path",children:s.jsx(q,{size:"md",children:s.jsx(Ds,{})})}),s.jsxs(te,{type:"modal",onClose:a=>{a&&t.mutate({albumId:e.id})},children:[s.jsx(q,{size:"md",disabled:t.isPending,children:s.jsx(js,{})}),s.jsx(xt,{isDanger:!0,title:s.jsx(d,{message:"Delete album"}),body:s.jsx(d,{message:"Are you sure you want to delete this album?"}),confirm:s.jsx(d,{message:"Delete"})})]})]})}function Ur({albums:e,showExternalFields:t}){const a=W();return s.jsxs(me,{children:[s.jsxs("div",{className:"md:flex gap-24",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image_small",diskPrefix:"artist_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),t&&s.jsx(qa,{name:"verified",className:"mt-14",children:s.jsx(d,{message:"Verified"})})]}),s.jsx("div",{className:"flex-auto mt-24 md:mt-0",children:s.jsxs(Ba,{isLazy:!0,children:[s.jsxs(Ka,{children:[s.jsx(Re,{children:s.jsx(d,{message:"Details"})}),s.jsx(Re,{children:s.jsx(d,{message:"Links"})}),s.jsx(Re,{children:s.jsx(d,{message:"Biography"})}),s.jsx(Re,{children:s.jsx(d,{message:"Images"})})]}),s.jsxs(Wa,{className:"pt-20",children:[s.jsx(ze,{children:s.jsx(_r,{showExternalFields:t})}),s.jsx(ze,{children:s.jsx(xn,{})}),s.jsx(ze,{children:s.jsx(Or,{})}),s.jsx(ze,{children:s.jsx(Hr,{})})]})]})})]}),s.jsx(Lr,{albums:e})]})}function _r({showExternalFields:e}){const{trans:t}=_();return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0,disabled:!e}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:Cs,name:"genres",allowCustomValue:!0,className:"mb-24"}),e&&s.jsx(qr,{})]})}function Or(){return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"profile.country",label:s.jsx(d,{message:"Country"}),className:"mb-24"}),s.jsx(M,{name:"profile.city",label:s.jsx(d,{message:"City"}),className:"mb-24"}),s.jsx(M,{inputElementType:"textarea",rows:5,name:"profile.description",label:s.jsx(d,{message:"Description"}),className:"mb-24"})]})}function Hr(){const{fields:e,append:t,remove:a}=dt({name:"profile_images"});return s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-12 flex-wrap mb-24",children:e.map((n,r)=>s.jsx(Je,{name:`profile_images.${r}.url`,diskPrefix:"artist_images",variant:"square",previewSize:"w-160 h-160",stretchPreview:!0,showRemoveButton:!0,onChange:i=>{i||a(r)}},n.id))}),s.jsx(V,{variant:"outline",color:"primary",startIcon:s.jsx(ks,{}),onClick:()=>{t({url:""})},children:s.jsx(d,{message:"Add another image"})})]})}function qr(){const{spotify_is_setup:e}=Z();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}const Br=e=>`artists/${e}`;function Kr(e){const{trans:t}=_(),a=Fe(),{pathname:n}=ue();return ce({mutationFn:r=>Wr(r),onSuccess:r=>{ae(t(I("Artist updated"))),de.invalidateQueries({queryKey:xe("artists")}),n.includes("admin")?a("/admin/artists"):a(Ga(r.artist))},onError:r=>Ae(r,e)})}function Wr({id:e,...t}){return L.put(Br(e),t).then(a=>a.data)}function Di({wrapInContainer:e,showExternalFields:t}){const a=Dt({loader:"editArtistPage"});return a.data?s.jsx(Gr,{response:a.data,wrapInContainer:e,showExternalFields:t}):s.jsx(bs,{query:a,loaderClassName:"absolute inset-0 m-auto"})}function Gr({response:e,wrapInContainer:t,showExternalFields:a}){var o;const{canEdit:n}=Qa(e.artist),r=ie({defaultValues:{id:e.artist.id,name:e.artist.name,verified:e.artist.verified,spotify_id:e.artist.spotify_id,genres:e.artist.genres,image_small:e.artist.image_small,links:e.artist.links,profile:e.artist.profile,profile_images:e.artist.profile_images}}),i=Kr(r);return n?s.jsx(Ve,{form:r,onSubmit:l=>{i.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ artist",values:{name:e.artist.name}}),isLoading:i.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Ur,{albums:(o=e.albums)==null?void 0:o.data,showExternalFields:a})}):s.jsx(vs,{to:"/",replace:!0})}const Qr={month:"short",day:"2-digit"};function Zr({value:e,onChange:t,disabled:a,compactOnMobile:n=!0,enableCompare:r=!1,granularity:i="minute"}){const o=W();return s.jsxs(te,{type:"popover",onClose:l=>{l&&t(l)},children:[s.jsx(V,{variant:"outline",color:"chip",endIcon:s.jsx(At,{}),disabled:a,children:s.jsx(Rt,{start:e.start,end:e.end,options:o&&n?Qr:nt.short})}),s.jsx(Yr,{value:e,enableCompare:r,granularity:i})]})}function Yr({value:e,enableCompare:t,granularity:a}){const n=W(),r=_s({granularity:a,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,o=_s({granularity:a,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:zt[0].getRangeValue(r.selectedValue)});return s.jsx(Sn,{state:r,compareState:t?o:void 0,compareVisibleDefault:i,showInlineDatePickerField:!n})}function Fs(e){const{title:t,description:a,children:n,className:r,contentIsFlex:i=!0,contentClassName:o,contentRef:l,minHeight:c="min-h-440"}=e;return s.jsxs("div",{className:S("rounded-panel flex h-full flex-auto flex-col border bg",c,r),children:[s.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[s.jsx("div",{className:"text-sm font-semibold",children:t}),a&&s.jsx("div",{className:"text-muted",children:a})]}),s.jsx("div",{ref:l,className:S("relative p-14",i&&"flex flex-auto items-center justify-center",o),children:n})]})}function Be(){return s.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[s.jsx(gs,{isIndeterminate:!0,size:"sm"}),s.jsx(d,{message:"Chart loading"})]})}const Jr=u.lazy(()=>Za(()=>import("./lazy-chart-8ce47917.js"),["./lazy-chart-8ce47917.js","./main-0876e57f.js","./main-1b5bc0ae.css"],import.meta.url));function sa(e){const{title:t,description:a,className:n,contentRef:r,isLoading:i}=e;return s.jsx(Fs,{title:t,description:a,className:n,contentRef:r,children:s.jsxs(u.Suspense,{fallback:s.jsx(Be,{}),children:[s.jsx(Jr,{...e}),i&&s.jsx(Be,{})]})})}function ta(e,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const o=r.data.map((l,c)=>{let f;return i===0||!a?(f=Xr(l,e.granularity,t),n[c]=f):f=n[c],{...f,value:l.value}});return{...r,data:o}})}}function Xr(e,t,a){return e.label?{label:e.label}:e.date?ei(e,t,a):{label:""}}function ei({date:e,endDate:t},a="day",n){const r=_e(e).toDate(),i=t?_e(t).toDate():null;switch(a){case"minute":return{label:U(n,{second:"2-digit"}).format(r),tooltipTitle:U(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:U(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:U(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:U(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:U(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:U(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:U(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,i)};case"month":return{label:U(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:U(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:U(n,{year:"numeric"}).format(r),tooltipTitle:U(n,{year:"numeric"}).format(r)}}}const U=Ya((e,t)=>new Ja(e,t),{equals:(e,t)=>rt(e,t),callTimeout:void 0}),Ws=je().themes.all[0].values["--be-primary"],ge=[[`rgb(${Ws.replaceAll(" ",",")})`,`rgba(${Ws.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],si={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function ti({data:e,className:t,...a}){const{localeCode:n}=ne(),r=u.useMemo(()=>{const i=ta(e,{localeCode:n});return i.datasets=i.datasets.map((o,l)=>({...o,backgroundColor:ge[l][1],borderColor:ge[l][0],pointBackgroundColor:ge[l][0]})),i},[e,n]);return s.jsx(sa,{...a,className:S(t,"min-w-500"),data:r,type:"line",options:si})}const ai={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Gs({data:e,className:t,...a}){const{localeCode:n}=ne(),r=u.useMemo(()=>{var o;const i=ta(e,{localeCode:n});return i.labels=(o=i.datasets[0])==null?void 0:o.data.map(l=>l.label),i.datasets=i.datasets.map((l,c)=>({...l,backgroundColor:ge.map(f=>f[1]),borderColor:ge.map(f=>f[0]),borderWidth:2})),i},[e,n]);return s.jsx(sa,{type:"polarArea",data:r,options:ai,className:S(t,"min-w-500"),...a})}const Qs="https://www.gstatic.com/charts/loader.js";function ni({placeholderRef:e,data:t,country:a,onCountrySelected:n}){const{trans:r}=_(),{analytics:i}=Z(),o=i==null?void 0:i.gchart_api_key,{selectedTheme:l}=Xa(),c=u.useRef(),f=!!n&&!a,m=u.useCallback(()=>{var y,k;if(typeof google>"u")return;const p=t.map(w=>[w.label,w.value]);p.unshift([r(a?I("City"):I("Country")),r(I("Clicks"))]);const h=`${Us(l.values["--be-paper"])}`,j={colorAxis:{colors:[`${Us(l.values["--be-primary"])}`]},backgroundColor:h,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:f};!c.current&&e.current&&((y=google==null?void 0:google.visualization)!=null&&y.GeoChart)&&(c.current=new google.visualization.GeoChart(e.current)),(k=c.current)==null||k.draw(google.visualization.arrayToDataTable(p),j)},[l,t,e,r,a,f]),x=u.useCallback(async()=>{Es.isLoadingOrLoaded(Qs)||(await Es.loadAsset(Qs,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:o}),m())},[o,m]);return u.useEffect(()=>(c.current&&n&&google.visualization.events.addListener(c.current,"regionClick",p=>n==null?void 0:n(p.region)),()=>{c.current&&google.visualization.events.removeAllListeners(c.current)}),[n,c.current]),u.useEffect(()=>{x()},[x]),u.useEffect(()=>{m()},[l,m,t]),{drawGoogleChart:m}}const ri=Q(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined");function ii({title:e,body:t,dialogSize:a="sm",className:n}){return s.jsxs(te,{type:"popover",triggerOnHover:!0,children:[s.jsx(q,{className:S("ml-4 text-muted opacity-70",n),iconSize:"xs",size:"2xs",children:s.jsx(ea,{viewBox:"0 0 16 16"})}),s.jsxs(Ce,{size:a,children:[e&&s.jsx(ys,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),s.jsx(De,{children:t})]})]})}const li=u.memo(({code:e})=>{const{localeCode:t}=ne(),a=new Intl.DisplayNames([t],{type:"region"});let n;try{n=a.of(e.toUpperCase())}catch{}return s.jsx(u.Fragment,{children:n})});function oi({data:e,isLoading:t,onCountrySelected:a,country:n,...r}){const i=u.useRef(null),o=!!a,l=e==null?void 0:e.datasets[0].data,c=u.useMemo(()=>l||[],[l]);return ni({placeholderRef:i,data:c,country:n,onCountrySelected:a}),s.jsxs(Fs,{...r,className:"min-w-500",title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{message:"Top Locations"}),n?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(li,{code:n}),")"]}):null,o&&s.jsx(ci,{})]}),contentIsFlex:t,children:[t&&s.jsx(Be,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:c.map(f=>s.jsxs("div",{className:S("flex items-center gap-4 mb-4",o&&"cursor-pointer hover:underline"),role:o?"button":void 0,onClick:()=>{a==null||a(f.code)},children:[s.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:f.label}),s.jsxs("div",{children:["(",f.percentage,")%"]})]},f.label))}),n&&s.jsx(V,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(ri,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(d,{message:"Back to countries"})})]})]})]})}function ci(){return s.jsx(ii,{title:s.jsx(d,{message:"Zooming in"}),body:s.jsx(d,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const Zs="reports/insights";function di(e,t){return re({queryKey:[Zs,e],queryFn:()=>ui(Zs,e),placeholderData:t.isEnabled?Ye:void 0,enabled:t.isEnabled})}function ui(e,t){var n;const a={model:t.model,metrics:(n=t.metrics)==null?void 0:n.join(",")};return a.startDate=t.dateRange.start.toAbsoluteString(),a.endDate=t.dateRange.end.toAbsoluteString(),a.timezone=t.dateRange.start.timeZone,L.get(e,{params:a}).then(r=>r.data)}const mi=Q(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");function Le({data:e,isLoading:t,...a}){const n=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(Fs,{...a,className:"min-w-500 md:min-w-0 w-1/2",contentIsFlex:t,contentClassName:"max-h-[370px] overflow-y-auto compact-scrollbar",children:[t&&s.jsx(Be,{}),n.map(r=>s.jsxs("div",{className:"mb-20 text-sm flex items-center justify-between gap-24",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(xi,{model:r.model,size:"w-42 h-42",className:"rounded flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(fi,{model:r.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(hi,{model:r.model})})]})]}),s.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[s.jsx(en,{className:"text-muted",size:"sm"}),s.jsx(d,{message:":count plays",values:{count:s.jsx(qe,{value:r.value})}})]})]},r.model.id)),!t&&!n.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(mi,{size:"sm"}),s.jsx(d,{message:"No plays in selected timeframe."})]}):null]})}function xi({model:e,size:t,className:a}){const{pathname:n}=ue(),i=n.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(J,{to:i,children:s.jsx(yt,{artist:e,size:t,className:a})});case"album":return s.jsx(J,{to:i,children:s.jsx(Xe,{album:e,size:t,className:a})});case"track":return s.jsx(J,{to:i,children:s.jsx(ws,{track:e,size:t,className:a})});case"user":return s.jsx(fn,{user:e,size:t,className:a})}}function fi({model:e}){switch(e.model_type){case"artist":return s.jsx(wt,{artist:e,target:"_blank"});case"album":return s.jsx(Ns,{album:e,target:"_blank"});case"track":return s.jsx(kt,{track:e,target:"_blank"});case"user":return e.id?s.jsx(sn,{user:e,target:"_blank"}):s.jsx(u.Fragment,{children:e.display_name})}}function hi({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(es,{artists:e.artists,target:"_blank"})}}function Ts(e){const a="flex flex-col lg:flex-row lg:items-center overflow-x-auto gap-12 md:gap-24 mb-12 md:mb-24",n=e.model,r=e.dateRange;return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:a,children:[s.jsx(G,{metric:"plays",model:n,dateRange:r,children:({data:i})=>s.jsx(ti,{className:"flex-auto",title:s.jsx(d,{message:"Plays"}),hideLegend:!0,description:s.jsx(d,{message:":count total plays",values:{count:s.jsx(qe,{value:(i==null?void 0:i.report.plays.total)||0})}})})}),s.jsx(G,{metric:"devices",model:n,dateRange:r,children:s.jsx(Gs,{title:s.jsx(d,{message:"Top devices"})})})]}),s.jsxs("div",{className:a,children:[e.showTracks&&s.jsx(G,{metric:"tracks",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played tracks"})})}),s.jsx(G,{metric:"users",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Top listeners"})})})]}),e.showArtistsAndAlbums&&s.jsxs("div",{className:a,children:[s.jsx(G,{metric:"artists",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played artists"})})}),s.jsx(G,{metric:"albums",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played albums"})})})]}),s.jsxs("div",{className:a,children:[s.jsx(G,{metric:"locations",model:n,dateRange:r,children:s.jsx(oi,{className:"flex-auto w-1/2 lg:max-w-[740px]"})}),s.jsx(G,{metric:"platforms",model:n,dateRange:r,children:s.jsx(Gs,{className:"max-w-500",title:s.jsx(d,{message:"Top platforms"})})})]})]})}function G({children:e,metric:t,model:a,dateRange:n}){var m,x;const[r,i]=u.useState(!1),o=di({metrics:[t],model:a,dateRange:n},{isEnabled:r}),l=typeof e=="function"?e(o):e,c=u.useRef(),f=u.useCallback(p=>{var h;if(p){const g=new IntersectionObserver(([j])=>{var y;j.isIntersecting&&(i(!0),(y=c.current)==null||y.disconnect(),c.current=void 0)},{threshold:.1});c.current=g,g.observe(p)}else c.current&&((h=c.current)==null||h.disconnect())},[]);return u.cloneElement(l,{data:(x=(m=o.data)==null?void 0:m.report)==null?void 0:x[t],isLoading:o.isLoading,contentRef:f})}function Vs({children:e,reportModel:t,title:a,isNested:n}){const[r,i]=u.useState(()=>St[2].getRangeValue()),{player:o}=Z();return W(),s.jsxs(u.Fragment,{children:[s.jsx(tn,{children:s.jsx(d,{message:"Insights"})}),s.jsx("div",{className:"h-full flex flex-col",children:s.jsxs(pt,{name:"web-player",initialRightSidenavStatus:o!=null&&o.hide_queue?"closed":"open",children:[s.jsx(gt,{size:"sm",menuPosition:"pricing-table-page",className:"flex-shrink-0"}),s.jsx(jt,{position:"left",display:"block",children:s.jsx(bt,{})}),s.jsx(vt,{children:s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",children:s.jsx("div",{className:"min-h-full p-12 md:p-24 overflow-x-hidden max-w-[1600px] mx-auto flex flex-col",children:s.jsxs("div",{className:"flex-auto",children:[s.jsxs("div",{className:"md:flex items-center justify-between gap-24 h-48 mt-14 mb-38",children:[a||s.jsx(pe,{className:"max-w-320"}),s.jsx("div",{className:"flex-shrink-0 flex items-center justify-between gap-10 md:gap-24",children:s.jsx(Zr,{value:r,onChange:i})})]}),u.cloneElement(e,{dateRange:r,model:t})]})})})})]})})]})}function $s({image:e,name:t,description:a}){return s.jsxs("div",{className:"flex items-center gap-10",children:[u.cloneElement(e,{size:"w-48 h-48",className:"rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-base whitespace-nowrap overflow-hidden overflow-ellipsis",children:["“",t,"“ ",s.jsx(d,{message:"insights"})]}),a&&s.jsx("div",{className:"text-muted text-sm",children:a})]})]})}function Pi({isNested:e}){const{artistId:t}=ss(),{data:a}=Dt({loader:"artist"});return s.jsx(Vs,{reportModel:`artist=${t}`,title:(a==null?void 0:a.artist)&&s.jsx($s,{image:s.jsx(yt,{artist:a.artist}),name:s.jsx(wt,{artist:a.artist})}),isNested:e,children:s.jsx(Ts,{showTracks:!0})})}function Si({isNested:e}){const{albumId:t}=ss(),{data:a}=Ct({loader:"album"});return s.jsx(Vs,{reportModel:`album=${t}`,title:(a==null?void 0:a.album)&&s.jsx($s,{image:s.jsx(Xe,{album:a.album}),name:s.jsx(Ns,{album:a.album}),description:s.jsx(es,{artists:a.album.artists})}),isNested:e,children:s.jsx(Ts,{showTracks:!0})})}function Ai({isNested:e}){const{trackId:t}=ss(),{data:a}=It({loader:"track"});return s.jsx(Vs,{reportModel:`track=${t}`,title:(a==null?void 0:a.track)&&s.jsx($s,{image:s.jsx(ws,{track:a.track}),name:s.jsx(kt,{track:a.track}),description:s.jsx(es,{artists:a.track.artists})}),isNested:e,children:s.jsx(Ts,{})})}export{gn as A,sa as B,On as C,Sn as D,Si as E,Mn as F,oi as G,Di as H,Ts as I,Pi as J,wi as K,ti as L,Gn as M,ri as N,Fr as O,Gs as P,Ht as Q,Zr as R,mi as S,yi as U,Tt as a,At as b,cs as c,St as d,Et as e,Rt as f,Lt as g,bi as h,xe as i,Bn as j,Wn as k,Te as l,Ve as m,Mt as n,Ut as o,Ii as p,Ci as q,Ur as r,ta as s,ge as t,_s as u,ii as v,vi as w,Ai as x,Ni as y,ki as z};
//# sourceMappingURL=backstage-track-insights-a9463ad9.js.map
